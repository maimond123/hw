---
title: "Homework 1"
author: "David Maimon"
format: pdf
date: "9/11/25"
---

```{r}
#Set Up 
library(lterdatasampler)
icecover <- ntl_icecover 
airtemp <- ntl_airtemp

library(tidyverse)
library(ggplot2)

#Ensuring data is within the correct year range
icecover <- icecover |>
  filter(year >= 1886, year <= 2019)

airtemp <- airtemp |>
  filter(year >= 1886, year <= 2019)

glimpse(icecover)

```

\

## Exercise 6

```{r}
##Part a
ggplot(icecover, aes(year, ice_duration, color = lakeid)) +
  geom_line() +
  geom_point(size = 0.8) +
  labs(x = "Year", y = "Ice duration (days)", color = "Lake",
       title = "Ice duration over time by lake")


```

b\. Averaging reduces lake-specific noise and gives a single series per year. It can hide differences between lakes. If both lakes have similar trends, then the average will be a good summary, but otherwise, the average will hide a lot of lake-specific variation. Using the average is simpler, but if the lakes differ significantly, then averaging will hide meaningful patterns.

## Exercise 7

```{r}
#a
airtemp_year <- airtemp |>
  group_by(year) |>
  summarise(air_temp_avg = mean(ave_air_temp_adjusted, na.rm = TRUE), .groups = "drop")
airtemp_year

analysis_df <- icecover |>
  filter(!is.na(ice_duration)) |>
  group_by(year) |>
  filter(n_distinct(lakeid) == 2) |>
  summarise(ice_duration_avg = mean(ice_duration), .groups = "drop") |>
  inner_join(airtemp_year, by = "year")

dim(analysis_df)


```

```{r}
#b
ggplot(analysis_df, aes(air_temp_avg, ice_duration_avg)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "Average air temperature (Â°C)",
       y = "Average ice duration (days)",
       title = "Ice duration vs. air temperature")
```

The relationship look roughly linear and negative, since the spread of points around the slope line look fairly balanced, without strong curvature or other pattern. For this reason, yes, a linear model is a reasonable choice.

## Exercise 8

1.  y : 134 x 1

2.  X: 134 x 2

3.  B: 2 x 1

4.  e: 134 x 1

```{r}
#b
y <- as.matrix(analysis_df$ice_duration_avg)
X <- cbind(Intercept = 1, Temp = analysis_df$air_temp_avg) |> as.matrix()
beta_hat <- solve(t(X) %*% X) %*% t(X) %*% y
beta_hat

```

```{r}
#c 
fit <- lm(ice_duration_avg ~ air_temp_avg, data = analysis_df)
round(coef(fit), 3)
summary(fit)

```

## Exercise 9

```{r}
#a
r2 <- summary(fit)$r.squared
r2
```

This means that only 14.98% of the variation in the average ice duration is explained by the average air temperature.

```{r}
#b 
rmse <- sqrt(mean(residuals(fit)^2))
rmse
```

The RMSE is about 15 days, meaning that on average our predictions for ice duration are off by about 2 weeks. From the the ice_duration vs. air_temp plot, we could see that typical ice durations range from 80 to 140 days, so the prediction error is fairly large in context, suggesting that while air temperature is related to ice duration, it is not the only factor.

c\. Since the R\^2 is low, and the RMSE is relatively high, we can say that the model fit is not great (model's predictions are imprecise).

## Exercise 10

a\. The slope of -6.6363 indicates that, on average, for every one degree celsius increase in average air temperate, the average_ice_duration for the 2 lakes decreases by 6.636 days. \

```{r}
tail(analysis_df)
```

b\. Using our regression formula, we have that \
Y-hat = 148.110 - 6.182 \* ( 7.925) = 99.1177

So, the predicted ice duration was approximately 99 days. \
\
The residual is calculated as (e = Y - Y-hat). This means e = (75 - 99.1177) = -24.1177 days.
